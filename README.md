# 财联社电报到飞书推送工具

这个工具可以自动获取财联社当天的电报信息，并将其保存到本地文件中，方便用户随时查看和管理。

## 功能特点

- **自动获取财联社电报**：获取当天的财联社电报信息
- **智能分类展示**：将重要电报（包含关键词的）和一般电报分开展示
- **本地文件保存**：将格式化后的电报信息保存到本地Markdown文件
- **自动文件管理**：自动清理旧文件，默认保留最近7个文件，避免文件过多难以管理
- **可自定义配置**：支持自定义输出目录、最大获取电报数量、标红关键词、文件保留数量等

## 使用方法

### 1. 配置脚本

打开`cls_to_feishu.py`文件，找到CONFIG部分，修改相关配置：

```python
CONFIG = {
    "OUTPUT_DIR": "./output/财联社电报",  # 电报保存目录，默认为脚本所在目录下的 output/财联社电报
    "FEISHU_WEBHOOK_URL": "",  # 飞书自动化 Webhook URL，用于触发飞书云文档创建
    # 其他配置...
}
```

-   **`OUTPUT_DIR`**：电报将以Markdown格式保存到此目录，文件名包含日期，例如 `财联社电报_2023-10-27.md`。每次运行脚本，新的电报内容将追加到当天的文件中。
-   **`FEISHU_WEBHOOK_URL`**：如果你希望在本地保存文件的同时，也触发飞书自动化流程（例如在飞书云空间创建文档），请在此处填写飞书自动化工作流的 Webhook URL。你需要根据飞书自动化平台的要求，配置接收 Webhook 的步骤，并处理脚本发送的 JSON 数据（包含 `telegrams` 和 `date` 字段）。

### 3. 安装依赖

```bash
pip install requests pytz
```

### 4. 运行脚本

```bash
python cls_to_feishu.py
```

## 自定义配置

你可以根据需要修改脚本中的CONFIG配置：

```python
CONFIG = {
    "OUTPUT_DIR": "./output/财联社电报",  # 输出目录
    "MAX_TELEGRAMS": 50,  # 最大获取电报数量
    "RED_KEYWORDS": ["利好", "利空", "重要", "突发", "紧急", "关注", "提醒"],  # 标红关键词
    "FILE_SEPARATOR": "━━━━━━━━━━━━━━━━━━━",  # 文件内容分割线
    "KEEP_FILES_COUNT": 7,  # 保留的文件数量，超过此数量的旧文件将被自动删除
}
```

## 设置定时任务

### Windows（使用任务计划程序）

1. 打开任务计划程序
2. 创建基本任务 -> 设置名称和描述 -> 每天触发 -> 设置时间 -> 启动程序
3. 程序/脚本：`python`
4. 添加参数：`D:\00kaifa\财联社\cls_to_feishu.py`（替换为你的实际路径）

### Linux/Mac（使用crontab）

```bash
# 编辑crontab
crontab -e

# 添加定时任务（每小时运行一次）
0 * * * * /usr/bin/python /path/to/cls_to_feishu.py
```

## 注意事项

1.  脚本默认获取当天（北京时间）的电报信息。
2.  包含特定关键词的电报会被标记为重要电报并在文件中标红显示。
3.  确保网络环境能够访问财联社API。
4.  如果配置了 `FEISHU_WEBHOOK_URL`，请确保该 URL 有效，并且飞书自动化工作流能够正确接收和处理脚本发送的 JSON 数据。
5.  脚本会自动清理旧文件，默认保留最近7个文件。可通过修改 `KEEP_FILES_COUNT` 配置项调整保留数量。
6.  文件清理基于文件的修改时间进行排序，确保最新的文件被保留。
